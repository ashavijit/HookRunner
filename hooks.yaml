tools:
  golangci-lint:
    version: 1.55.2
    install:
      windows: https://github.com/golangci/golangci-lint/releases/download/v1.55.2/golangci-lint-1.55.2-windows-amd64.zip
      linux: https://github.com/golangci/golangci-lint/releases/download/v1.55.2/golangci-lint-1.55.2-linux-amd64.tar.gz
      darwin: https://github.com/golangci/golangci-lint/releases/download/v1.55.2/golangci-lint-1.55.2-darwin-amd64.tar.gz

# Policy configuration - remote + local
policies:
  type: raw
  policies:
    - url: https://hookrunner.avijitsen.site/policies/sensitive-secrets.yaml
  localPolicies:
    - name: commit-format
      version: local
      rules:
        max_files_changed: 50
        forbid_directories:
          - vendor/
          - node_modules/
        forbid_file_extensions:
          - .exe
          - .dll
        exclude_extensions:
          - .md
          - .txt
          - .json
          - .yaml
          - .yml
        commit_message:
          regex: "^(feat|fix|chore|docs|refactor|test|build|ci):"
          error: "Commit must follow conventional format (feat|fix|chore|docs|refactor|test|build|ci):"

hooks:
  pre-commit:
    - name: gofmt
      tool: go
      args: ["fmt", "./..."]
      files: "\\.go$"
      exclude: "_test\\.go$"

    - name: govet
      tool: go
      args: ["vet", "./..."]
      files: "\\.go$"
      after: gofmt

  pre-push:
    - name: test
      tool: go
      args: ["test", "./..."]
      timeout: 5m
      env:
        CGO_ENABLED: "0"
